---
layout: single
published: true
title:  "[DB] 서브 쿼리"
categories: Database
date: 2024-02-26 18:45:47
toc: true
toc_sticky: true
tag:   
  - 데이터베이스
  - Database
  - 서브 쿼리
---

## 서브 쿼리란?

하나의 SQL문 안에 포함되어 있는 또 다른 SQL문을 의미합니다. 최종 결과를 출력하는 쿼리를 메인 쿼리라고 한다면 메인 쿼리의 보조 역할을 하는 것이 서브 쿼리라고 할 수 있습니다.

## 예시에서 사용할 데이터

> students 테이블
> 

| name | age | address |
| --- | --- | --- |
| 이황 | 28 | 경상북도 |
| 정약용 | 29 | 경기도 |
| 김정호 | 30 | 전라북도 |
| 박지원 | 31 | 전라북도 |
| 김홍도 | 32 | 경기도 |
| 신윤복 | 33 | 서울특별시 |
| 김광균 | 34 | 서울특별시 |
| 한용운 | 35 | 경상남도 |
| 박두진 | 36 | 경기도 |

> classes 테이블
> 

| name | class_name |
| --- | --- |
| 이황 | 데이터베이스 |
| 이황 | 알고리즘 |
| 정약용 | 데이터베이스 |
| 김정호 | 자료구조 |
| 박지원 | 데이터베이스 |
| 김홍도 | 알고리즘 |
| 신윤복 | 자료구조 |
| 신윤복 | 알고리즘 |
| 김광균 | 데이터베이스 |
| 김광균 | 자료구조 |
| 김광균 | 알고리즘 |

## SELECT 절에서 사용하는 서브 쿼리

나이가 30세 미만인 학생의 이름, 나이, 그리고 모든 학생들의 평균 나이를 조회하는 SQL 문 입니다.

```sql
SELECT
	name,
	age,
	(SELECT AVG(age) FROM students) AS avg_age
FROM students
WHERE age < 30
```

SELECT문에 학생의 평균 나이를 조회하는 또 다른 SQL문이 들어간 것을 볼 수 있습니다. 이처럼 더욱 풍부한 결과를 얻을 수 있게 해주는 것이 서브 쿼리입니다.

> 결과
> 

| name | age | avg_age |
| --- | --- | --- |
| 이황 | 28 | 32.0000000000000000 |
| 정약용 | 29 | 32.0000000000000000 |

## FROM 절에서 사용하는 서브 쿼리

데이터베이스, 알고리즘 수강 정보를 조회하는 SQL 문 입니다.

```sql
SELECT *
FROM
	(
		SELECT name, class_name
		FROM classes
		WHERE class_name IN ('데이터베이스', '알고리즘')
	)
```

FROM절의 서브 쿼리의 경우 서브 쿼리의 결과를 마치 가상의 테이블처럼 사용할 수 있습니다.

> 결과
> 

| name | class_name |
| --- | --- |
| 이황 | 데이터베이스 |
| 이황 | 알고리즘 |
| 정약용 | 데이터베이스 |
| 박지원 | 데이터베이스 |
| 김홍도 | 알고리즘 |
| 신윤복 | 알고리즘 |
| 김광균 | 데이터베이스 |
| 김광균 | 알고리즘 |

## WHERE 절에서 사용하는 서브 쿼리

데이터베이스, 알고리즘을 수강하는 학생의 이름, 나이, 주소를 조회하는 SQL 문 입니다.

```sql
SELECT name, age, address
FROM students
WHERE name IN (
	SELECT name
	FROM classes
	WHERE class_name IN ('데이터베이스', '알고리즘')
)
```

1. 서브 쿼리에서 classes 테이블에서 데이터베이스, 알고리즘을 수강하는 학생의 이름을 조회합니다.
2. students 테이블에서 서브 쿼리에서 조회한 이름만 필터링하여 결과로 보여줍니다.

> 결과
> 

| name | age | address |
| --- | --- | --- |
| 이황 | 28 | 경상북도 |
| 정약용 | 29 | 경기도 |
| 박지원 | 31 | 전라북도 |
| 김홍도 | 32 | 경기도 |
| 신윤복 | 33 | 서울특별시 |
| 김광균 | 34 | 서울특별시 |